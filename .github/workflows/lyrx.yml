name: Lyrx Github Pages Deployment

on:
  push:
    branches: [ "master" ]
#     paths:
#         - examples/lyrx
  pull_request:
    branches: [ "master" ]
    paths:
        - examples/lyrx

env:
  CARGO_TERM_COLOR: always
  RUST_LOG: debug

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Build static files
      working-directory: examples/lyrx/content
      run: cargo run -- .
      
#     - name: Upload to static site repository
#       working-directory: examples/lyrx/build
#       run: |
#         git init
#         git remote add origin git@github.com:Lyr-7D1h/lyrx.git
#         git add .
#         git push
    - name: Deploy to external repository
      uses: cpina/github-action-push-to-another-repository@main
      env:
        # üèóÔ∏è <internal repository>, run GitHub Action.
        # üéÅ <external repository>, receiving Artifacts.
        #
        # Way 1: using Personal Access Token
        # @see https://cpina.github.io/push-to-another-repository-docs/setup-using-personal-access-token.html#setup-personal-access-token
        # 1.1 Generate Personal Access Token: <external repository>/<Avatar>/Settings/Developer settings/Personal access tokens/Generate new token
        #     Select `No expiration` and Check `‚úÖÔ∏è repo    Full control of private repositories`, Generate and then Copy the Token
        # 1.2 Then make the token available to the GitHub Action: <internal repository>/Settings/Secrets/Actions/New repository secret
        #     Name: EXTERNAL_REPOSITORY_PERSONAL_ACCESS_TOKEN, Value Paste the Token
        API_TOKEN_GITHUB: ${{ secrets.EXTERNAL_REPOSITORY_PERSONAL_ACCESS_TOKEN }}
        # Way 2: using SSH deploy keys
        # @see https://cpina.github.io/push-to-another-repository-docs/setup-using-ssh-deploy-keys.html#setup-ssh-deploy-keys
        # 2.1 Generate an SSH key in terminal (Leave the passphrase empty)
        # 2.2 Add public key in the external repository: <external repository>/Settings/Deploy keys/Add deploy key
        #     Name: DEPLOY_PUBLIC_KEY, Value Paste the public key. Enable "‚úÖÔ∏è Allow write access"
        # 2.3 Add private key in the source repository: <external repository>/Settings/Secrets/Actions/New repository secret
        #     Name: DEPLOY_PRIVATE_KEY, Value Paste the private key.
        # SSH_DEPLOY_KEY: ${{ secrets.DEPLOY_PRIVATE_KEY }}
      with:
        source-directory: examples/lyrx/build
        destination-github-username: lyr-7d1h
        destination-repository-name: lyrx
        user-email: lyr-7d1h@pm.me
        target-branch: master
